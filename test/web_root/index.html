
<html>
<script>

var matches = {
    "subject-match" : 
        [   {"$" : {"attr" : "api-feature", "match" : "http://webinos.org/api/nfc"}} 
            ,
            {"$" : {"attr" : "api-feature", "match" : "http://webinos.org/api/sensor"}}
        ]
 };
 var matches2 = {
    "subject-match" : 
        [   {"$" : {"attr" : "api-feature", "match" : "http://webinos.org/api/location"}} 
        ]
 };

var condition = 
    {
        "$":{"id":"cond3", "combine":"or"},
        "resource-match":[
            {"$":{"attr":"api-feature", "match":"minnie"}},
            {"$":{"attr":"api-feature", "match":"topolino"}}
        ]
    };

var condition2 = 
    {
        "$":{"id":"cond3", "combine":"and"},
        "resource-match":[
            {"$":{"attr":"api-feature", "match":"nonno"}},
            {"$":{"attr":"api-feature", "match":"nanni"}}
        ]
    };


var policyeditor;

function start(){
    //alert(webinos);
    webinos.discovery.findServices(new ServiceType('http://webinos.org/core/policymanagement'), 
        {onFound: function (service){ 
            //alert(1);
            policyeditor =  service;
            policyeditor.bindService({onBind: function (service) {
                //alert(2);
                var ps = policyeditor.getPolicySet(0, function(ps){
                    //alert(3);
                    var pol;
                    var policyset;
                    pol = ps.getPolicy("p2");
                    console.log(pol);
                    //*****************  TEST POLICY SET *******************
                    // TEST          addPolicy - removePolicy
                    
                    /*
                    alert("Test2 : add two policies with same id");
                    var p10 = ps.createPolicy("same_id","permit-overrides","descr p10");
                    ps.addPolicy(p10);
                    alert(ps.toJSONString());
                    var p11 = ps.createPolicy("same_id","permit-overrides","descr p11");
                    ps.addPolicy(p11);
                    alert(ps.toJSONString());
                    */
                    
                    //TEST remove all policies and add one
                    /*
                    alert(ps.toJSONString());
                    ps.removePolicy("p1");
                    alert(ps.toJSONString());
                    ps.removePolicy("p2");
                    alert(ps.toJSONString());
                    var pol = ps.createPolicy("p3", "deny-overrides", "description");
                    ps.addPolicy(pol, 0);
                    alert(ps.toJSONString());
                    */
                    //TEST       getPolicySet-getPolicy
                    //TEST getting a policyset and a policy where there are not present
                    /*
                    alert(ps.toJSONString());
                    pol = ps.getPolicy("NOT_PRESENT");
                    alert(ps.toJSONString());
                    pol = ps.getPolicySet("NOT_PRESENT");
                    alert(ps.toJSONString());
                    */
                    //TEST           addPolicySet - removePolicySet
                    //TEST add, remove and add policyset
                    /*
                    alert(ps.toJSONString());
                    var policyset = ps.createPolicySet("ps1", "first-applicable", "desc");
                    ps.addPolicySet(policyset, 0);
                    alert(ps.toJSONString());
                    policyset = ps.createPolicySet("ps2", "deny-overrides", "desc");
                    ps.addPolicySet(policyset, 0);
                    alert(ps.toJSONString());
                    ps.removePolicySet("ps1");
                    alert(ps.toJSONString());
                    ps.removePolicySet("ps2");
                    alert(ps.toJSONString());
                    policyset = ps.createPolicySet("ps2", "deny-overrides", "desc");
                    ps.addPolicySet(policyset, 0);
                    alert(ps.toJSONString());
                    */
                    //TEST add two policySet with same id
                    /*
                    alert(ps.toJSONString());
                    var policyset = ps.createPolicySet("ps1", "first-applicable", "desc");
                    ps.addPolicySet(policyset, 0);
                    alert(ps.toJSONString());
                    policyset = ps.createPolicySet("ps1", "deny-overrides", "desc");
                    ps.addPolicySet(policyset, 0);
                    alert(ps.toJSONString());
                    */
                    /*
                    var policyset = ps.createPolicySet("ps1", "first-applicable", "desc");
                    ps.addPolicySet(policyset, 0);
                    alert(ps.toJSONString());
                    ps.removePolicySet("NOT_PRESENT");
                    alert(ps.toJSONString());
                    */
                    // TEST          add-update-remove Subject
                    //TEST add two subject with same id
                    /*
                    alert(ps.toJSONString());
                    var policyset = ps.createPolicySet("ps1", "first-applicable", "desc");
                    ps.addPolicySet(policyset, 0);
                    alert(policyset.toJSONString());
                    policyset = ps.getPolicySet("ps1");
                    policyset.addSubject("sub1", matches);
                    alert(policyset.toJSONString());
                    policyset.addSubject("sub1", matches2);
                    alert(policyset.toJSONString());
                    */
                    //TEST add-remove-add subject
                    /*
                    alert(ps.toJSONString());
                    var policyset = ps.createPolicySet("ps1", "first-applicable", "desc");
                    ps.addPolicySet(policyset, 0);
                    alert(policyset.toJSONString());
                    policyset = ps.getPolicySet("ps1");
                    policyset.addSubject("sub1", matches);
                    alert(policyset.toJSONString());
                    policyset.removeSubject("sub1");
                    alert(policyset.toJSONString());
                    policyset.addSubject("sub1", matches2);
                    alert(policyset.toJSONString());
                    */
                    //TEST updateSubject
                    /*
                    alert(ps.toJSONString());
                    policyset = ps.createPolicySet("ps1", "first-applicable", "desc");
                    ps.addPolicySet(policyset, 0);
                    alert(policyset.toJSONString());
                    policyset = ps.getPolicySet("ps1");
                    policyset.addSubject("sub1", matches);
                    alert(policyset.toJSONString());
                    policyset.updateSubject("sub1", matches2);
                    alert(policyset.toJSONString());
                    //updating unexisting subject
                    policyset.updateSubject("NO_PRESENT", matches);
                    alert(policyset.toJSONString());
                    //updating with no subject present
                    policyset.removeSubject("sub1");
                    policyset.updateSubject("NO_PRESENT", matches);
                    alert(policyset.toJSONString());
                    //removing with no subject present
                    policyset.removeSubject("sub1");
                    alert(policyset.toJSONString());
                    */
                    //TEST                        updateAttributes
                    /*
                    ps.addPolicySet("ps1", "deny-overrides", "description", 0);
                    var policyset = ps.getPolicySet("ps1");
                    alert(ps.toJSONString());
                    policyset.updateAttributes("combine", "permit-overrides");
                    alert(ps.toJSONString());
                    policyset.updateAttributes("description", "new description");
                    alert(ps.toJSONString());
                    */
                    
                    //***************** TEST POLICY ******************************
                    
                    
                    
                    //TEST         add-update-remove Subject                
                    /*
                    alert("Test6 : Add subject, than add subject with same id");
                    pol = ps.getPolicy("p2");
                    alert(pol.toJSONString());
                    pol.addSubject("sub1", matches);
                    alert(pol.toJSONString());
                    pol.addSubject("sub1", matches2);
                    alert(pol.toJSONString());
                    */
                    //TEST3 test policy.addsubject
                    /*
                    alert("Test3 : getPolicy, add subject, remove subject and add subject");
                    pol = ps.getPolicy("p2");
                    alert(pol.toJSONString());
                    pol.addSubject("sub1", matches);
                    alert(pol.toJSONString());
                    pol.removeSubject("sub1");
                    alert(pol.toJSONString());
                    pol.addSubject("sub1", matches);
                    alert(pol.toJSONString());
                    */
                    //TEST removing subject in a policy with no subject
                    /*pol = ps.getPolicy("p2");
                    alert(pol.toJSONString());
                    pol.removeSubject("sub1");*/
                    //TEST removing subject not present in policy
                    /*
                    pol = ps.getPolicy("p2");
                    alert(pol.toJSONString());
                    pol.addSubject("sub1", matches);
                    alert(pol.toJSONString());
                    pol.removeSubject("sub2");
                    alert(pol.toJSONString());
                    */
                    //TEST add two subject with same id
                    /*
                    pol = ps.getPolicy("p2");
                    alert(pol.toJSONString());
                    pol.addSubject("sub1", matches);
                    alert(pol.toJSONString());
                    pol.addSubject("sub1", matches2);
                    alert(pol.toJSONString());
                    */
                    //TEST update Subject
                    /*
                    pol = ps.getPolicy("p2");
                    console.log(pol);
                    alert(pol.toJSONString());
                    pol.addSubject("sub1", matches);
                    alert(pol.toJSONString());
                    pol.updateSubject("sub1", matches2);
                    alert(ps.toJSONString());
                    //updating not present subject
                    pol.updateSubject("NOT_PRESENT", matches);
                    alert(ps.toJSONString());
                    pol.removeSubject("sub1");
                    alert(ps.toJSONString());
                    //updating with no subject present in policy
                    pol.updateSubject("sub1", matches);
                    */
                    //TEST     add-update-remove Rule
                    /*
                    alert("Test1: get a policy, add a rule, update the rule")
                    var pol = ps.getPolicy("p2");
                    alert("Policy : "+pol.toJSONString());
                    pol.addRule("rule 3", "permit", condition2);
                    alert(ps.toJSONString());
                    pol.updateRule("rule 3","deny", condition);
                    alert(ps.toJSONString());  
                    */
                    //TEST removeRule
                    /*
                    pol = ps.getPolicy("p2");
                    pol.addRule("rule 3", "permit", condition2);
                    alert(pol.toJSONString());
                    pol.addRule("rule 4", "deny", condition);
                    alert(pol.toJSONString());
                    pol.removeRule("rule 3");
                    alert(pol.toJSONString());
                    pol.removeRule("rule 4");
                    alert(pol.toJSONString());
                    pol.addRule("rule 4", "deny", condition);
                    alert(pol.toJSONString());
                    */
                    //TEST updateRule
                    /*
                    pol = ps.getPolicy("p2");
                    pol.addRule("rule 3", "permit");
                    alert(pol.toJSONString());
                    pol.updateRule("rule 3", "effect", "permit-overrides");
                    alert(pol.toJSONString());
                    pol.updateRule("rule 3", "condition", condition);
                    alert(pol.toJSONString());
                    pol.updateRule("rule 3", "condition", condition2);
                    alert(pol.toJSONString());
                    pol.updateRule("rule 3", "condition");
                    alert(pol.toJSONString());
                    */
                    //TEST      updateAttributes
                    /*
                    pol = ps.getPolicy("p2");
                    alert(ps.toJSONString());
                    pol.updateAttributes("combine", "first-applicable");
                    alert(ps.toJSONString());
                    pol.updateAttributes("description","new desc");
                    alert(ps.toJSONString());
                    */
                    
                
                }, null);
            }});
        }
    });
}



</script>

<body>
 <button onClick="start()">Start</button>
 </body>   
</html>